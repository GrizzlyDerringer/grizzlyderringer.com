<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
    crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jplayer/2.9.2/jplayer/jquery.jplayer.min.js"></script>
<script src="{{ "/assets/js/swipeable-carousel.js" | prepend: site.baseurl }}"></script>
<script type="text/javascript">
    $(function () {
        'use strict';
        function trackEvent(action, label) {
            if (window.ga) {
                ga('send', {
                    hitType: 'event',
                    eventCategory: 'songs',
                    eventAction: action,
                    eventLabel: label
                });
            }
        }

        +function setUpPlayer() {
            var $jplayer = $('.player').jPlayer({
                supplied: 'mp3',
                ended: onEnded
            });

            setBindings();

            function onTrackRowClick(e) {
                e.preventDefault();
                var $this = $(this),
                    $playbutton = $this.find('.song-control'),
                    href = $playbutton.attr('href');
                if ($this.hasClass('playing')) {
                    $jplayer.jPlayer('pause');
                    $('.playlist-row').removeClass('playing');
                    $playbutton.removeClass('glyphicon-pause')
                        .addClass('glyphicon-play');
                    setBindings();
                    $('.jp-audio').removeClass('is-playing');
                } else {
                    playTrack(href);
                    $('.playlist-row').removeClass('playing');
                    $this.addClass('playing');
                    $('.song-control')
                        .removeClass('glyphicon-pause')
                        .addClass('glyphicon-play');
                    $playbutton.removeClass('glyphicon-play');
                    $playbutton.addClass('glyphicon-pause');
                    setBindings();
                }
            }

            function onPlayButtonClick(e) {
                e.stopPropagation();
                e.preventDefault();
                var $this = $(this),
                    href = $this.attr('href');
                playTrack(href);
                $('.playlist-row').removeClass('playing')
                $this.closest('tr').addClass('playing');
                $('.song-control')
                    .removeClass('glyphicon-pause')
                    .addClass('glyphicon-play');
                $this.removeClass('glyphicon-play');
                $this.addClass('glyphicon-pause');
                setBindings();
            }

            function onPauseButtonClick(e) {
                e.stopPropagation();
                e.preventDefault();
                var $this = $(this);
                $jplayer.jPlayer('pause');
                $('.playlist-row').removeClass('playing');
                $this.removeClass('glyphicon-pause')
                    .addClass('glyphicon-play');
                setBindings();
                $('.jp-audio').removeClass('is-playing');
            }

            function onEnded() {
                var $next_tr = $('.glyphicon-pause').closest('tr').next('tr'),
                    $next_playbutton = $next_tr.find('.glyphicon-play');
                $('.playlist-row').removeClass('playing');
                $next_tr.addClass('playing');
                $('.song-control')
                    .removeClass('glyphicon-pause')
                    .addClass('glyphicon-play');
                if ($next_playbutton) {
                    var href = $next_playbutton.attr('href');
                    playTrack(href);
                    $next_playbutton.removeClass('glyphicon-play');
                    $next_playbutton.addClass('glyphicon-pause');
                }
                setBindings();
            }

            function setBindings() {
                $('.glyphicon-pause').off().on('click', onPauseButtonClick);
                $('.glyphicon-play').off().on('click', onPlayButtonClick);
                $('.playlist-row').off().on('click', onTrackRowClick);                
            }

            function playTrack(href) {
                $jplayer.jPlayer('setMedia', {
                    mp3: href
                }).jPlayer('play');
                $('.jp-audio').addClass('is-playing');
                trackEvent('playbackStart', href);
            }
        } ();

        +function setUpCarousel() {
            const BEFORE_SLIDE = 'slide.bs.carousel';
            const AFTER_SLIDE = 'slid.bs.carousel';
            const $HOME_CAROUSEL = $("#homeCarousel");

            $HOME_CAROUSEL.carousel({
                interval: 10000 //changes the speed
            });

            //before slide
            $HOME_CAROUSEL.on(AFTER_SLIDE, function (slide) {

            });

        } ();

        +function getUpcomingEvents() {
            const url = 'https://api.bandsintown.com/artists/Grizzly%20Derringer/events.json?api_version=2.0&app_id=js_grizzlyderringer.com&extended=true&widget_version=1.5.2&callback=bit_jsonp1484343130858';
            $.get(url, function (data) {
                if (!data.length) return;
                
                var html = '';
                for (var i=0; i<data.length; i++) {                    
                    const show = data[i];
                    const venue = show.venue;                    
                    const datetime = new Date(show.datetime);
                    const month = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][datetime.getMonth()];
                    const date = datetime.getDate();
                    html += '<tr>';
                    html += '<td>'
                    html += month + ' ' + date + ' - ' + venue.name;
                    html += '</br>';
                    html += '<strong>' + show.formatted_location + '</strong>';
                    html += '</td><td>';
                    html += '<a href="' + show.facebook_rsvp_url + '" class="btn btn-success btn-xs">RSVP</a>';
                    html += '</td></tr>';       
                    if (data.length > 1) {
                        html+= '<tr><td colspan="2"><hr/></td></tr>'                      
                    }                    
                }
                $('#upcoming_shows').html(html);                
            }, 'jsonp');            
        } ();  

        +function getIntagramPhotos () {
            const url = 'https://api.instagram.com/v1/users/self/media/recent/?access_token=1604842349.de0191f.30341075fd3c40d39d55203ee095bc00';
            $.get(url, function (data) {
                console.log(data);                                
                var html = '<div class="row">';
                for(var i=0; i < 12; i++) {                    
                    var link = data.data[i].link;
                    var images = data.data[i].images;
                    var thumbnail = images.thumbnail;
                    html += '<div class="col-xs-6 col-sm-4">';
                    html += '<a href="' + link + '" target="_blank">'
                    html += '<img src="' + thumbnail.url + '" class="img-thumbnail" style="margin-bottom:5px" />'
                    html += '</a>'         
                    html += '</div>';
                }
                html += '</div>';
                $('.instafeed').html(html);
            }, 'jsonp');            
        } ();      
    
        +function setUpNewsFeedLinks () {                                                            
            $('.scroll-to-link').on('click', function (e) {
                e.preventDefault();
                const isHome = window.location.pathname === '{{ "/" | prepend: site.baseurl }}';
                if(!isHome) {
                    return window.location = '{{ "/#news" | prepend: site.baseurl }}';
                }
                const target = $(this).attr('href')
                $("html, body").animate({ scrollTop: $(target).offset().top - 50 }, 750);
            });
        }();    
    });
    
    (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', '{{ site.ga_id }}', 'auto');
    ga('send', 'pageview');

</script>